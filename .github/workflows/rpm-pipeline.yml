name: Pull Red Hat Docker Image and Download RPM

on:
  push:
    branches:
      - main

  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up QEMU
      run: docker run --rm --privileged multiarch/qemu-user-static --reset -p yes

    - name: Login
      run: echo "${{ secrets.DOCKER_PWD }}" | docker login -u "${{ secrets.DOCKER_USER }}" --password-stdin docker.io

    - name: Pull Red Hat Docker Image
      run: docker pull docker.io/redhat/ubi8

    - name: Run a Docker container in detached mode
      run: docker run -d --name my-ubi8-container docker.io/redhat/ubi8 sleep infinity
    
    - name: Install yum (inside the container)
      run: docker exec my-ubi8-container dnf install -y yum
      
    - name: Install wget (inside the container)
      run: docker exec my-ubi8-container yum install -y wget

    - name: Download RPM package
      run: docker exec my-ubi8-container wget -O /tmp/package.rpm "http://repo.okay.com.mx/centos/8/x86_64/release/wget-1.19.5-7.el8.1.x86_64.rpm"

    - name: Exit the Docker container
      run: exit
